# 2 単一責任のクラスを設計する（Single Responsibility Principle）

オブジェクト指向設計のシステムの基礎は「メッセージ」です。しかし、その組織の構造で最も目立つのは「クラス」です。

## 2.1 クラスに属するものを決める

どんなクラスをつくるかによって、そのアプリケーションに対する考え方が永久に変わります。

設計とはアプリケーションの可変性を保つために技巧を凝らすことであり、完璧を目指すための行為ではありません。

「変更がかんたんであること」

- 変更は副作用をもたらさない
- 要件の変更が小さければ、コードの変更も相応にして小さい
- 既存のコードはかんたんに再利用できる
- 最もかんたんな変更方法はコードの追加である。ただし追加するコードはそれ自体変更が容易なものとする

コードとしては、

- 見通しが良い
  - 変更するコードにおいても、そのコードに依存する別の場所のコードにおいても、変更がもたらす影響が明白である
- 合理的
  - どんな変更であっても、かかるコストは変更がもたらす利益にふさわしい
- 利用性が高い
  - 新しい環境、予期していなかった環境でも再利用できる
- 模範的
  - コードに変更を加える人が、上記の品質を自然と保つようなコードになっている

## 2.2 単一の責任を持つクラスをつくる

### クラスが単一責任かどうか見極める

クラスの持つメソッドを質問に言い換えたときに、意味を成す質問になっているべきです。

たとえば、

- 「Gearさん、あなたの比を教えてくれませんか？」 :ok_woman:
- 「Gearさん、あなたのgear_inchesを教えてくれませんか？」 :worried:
- 「Gearさん、あなたのタイヤ（のサイズ）を教えてくれませんか？」 :innocent:

## 2.3 変更を歓迎するコードを書く

### データではなく、振る舞いに依存する

データへのアクセスの方法

1. インスタンス変数を直接参照する方法
2. インスタンス変数をアクセサメソッドで包み隠す方法

```rb
class Gear
  def initialize(chainring, cog)
    @chainring = chainring
    @cog = cog
  end

  def ratio
    # インスタンス変数を直接参照しているので、破滅への道
    @chainring / @cog.to_f
  end
end
```

```rb
class Gear
  attr_reader :chainring, :cog

  def initialize(chainring, cog)
    @chainring = chainring
    @cog = cog
  end

  def ratio
    chainring / cog.to_f
  end
end
```

```rb
# attr_readerによるデフォルトの実装
def cog
  @cog
end
```

**コグはデータ（どこからでも参照される）から振る舞い（1ヶ所で定義される）へと変わります。**
